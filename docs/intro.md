# 系统架构

微服务系统以程序运行方式观点来看，就是把一个重组合的应用程序拆分成轻量的进程，这些进程(可能一次启动若干个)每一个仅提供最小的功能，然后把这些进程层层叠叠地联结成计算图(`Compute Graph`),通过 `RPC` 等通信方式互相调用，在最外层组装起来，为外部调用提供一套完整的服务。

## 概念

**服务管理器** 一个服务就是一个独立的系统进程。既然是服务，那么就不能在操作系统层面直接操作进程。我们应当为用户提供无感知的，轻量快速的进程创建与启动方式。本微服务系统把这些进程称为服务。把服务的创建与运行交给服务管理器。服务管理器负责创建、启动、停止服务，管理服务间的通信，把能正常工作的服务记录在服务注册表(`Service Registry`)中。另外，负责所属服务的负载均衡(`Load balancing`)功能和提供一定范围内的服务发现(`service discovery`)功能。

**服务** 从代码的角度看，服务(`Service`)就是一个我空间的`js`模块,它由服务工厂创建，分为内部服务、本地服务和远程服务。内部服务提供服务监控、健康检查和跨服务日志收集。本地服务是在相同名字空间和相同节点名下运行的服务。远程服务是在不同节点名下(即使在同一台机器的相同名字空间中)运行的服务。服务管理器可以同时拥有本地服务和远程服务。从代码编写的角度看，本地服务利用 `IPC` 通信,远程服务使用 `RPC` 通信。

**通信** 各服务之间需要通信，我们将通信在上层抽象成事件接口，保持内部和外部通信的一致性。

**限流器与断路器** 服务端限流可能会与客户端限流重合，但是因为服务不知道客户会不会限流(尤其是恶意连接)，保守起见，我们需要提供限流策略。断路器可以防止应用程序反复尝试执行可能失败的操作。如果某个服务不能很好地提供服务时，不断开此服务的连接，将会导致拖慢系统。断路器模式还使应用程序能够检测故障是否已解决。如果问题已得到解决，则应用程序可以尝试调用该服务。
